---
layout: post
category: work
keyword: 动画
title: 说说动画
---

最近在弄一些动画相关的项目，越发觉得CSS的强大，尤其是之前看到[@shrekshrek](https://github.com/shrekshrek/css3d-engine)的[某宝造物节](http://show.im20.com.cn/zwj/)。所以这里也拿其中一个项目来做例子谈谈这个动画的二三事#24。

先来看个需求：

![手账本]({{site.assets}}/article/201612/gift.gif)

有同事看到这个效果说不知道怎么做，是个很复杂的东西。但其实并不然，要谨记一个原则，**一切复杂的东西都可以拆成一个一个简单的部分**，动画也是一样的道理。

这个动画其实可以分成3部分来说：

1. 一开始绘中间部分的线条动画。
2. 吐票动画，其他元素**不规则块状**出现，以及部分线性出现。
3. 最后显露出底部内容的橡皮擦效果。

既然已经分开了各部分的效果了，那么现在只需要逐一击破那就可以了！

首先是线条动画，看到效果的时候会不会有一种这个传统CSS怎么做出来啊，需要canvas的帮助啊，canvas怎么写啊，这样的疑问呢？但其实不用到这么复杂的地步，的确传统的HTML、CSS是难以实现这样的效果（*除非是帧动画/gif*），但是前端的体系并不止这么小的嘛，细看一下这是一根根线在画东西而已，那么我们就可以祭出矢量好帮手SVG大人了。如果对SVG有研究的童鞋也知道，这种效果可以用**stroke-dasharray、stroke-dashoffset**两兄弟，简单来说这两个属性一个是可以调整图形的线段样子（实线、虚线）,一个是可以调整虚线的起始位置，那么我们只需要把虚线的间隙弄到和它自身的长度一样，然后再把开始位置做对应长度的调整，那么原来的图形就会被“隐藏”掉，这时候只需要不断改变stroke-dashoffset的值，就可以让图形慢慢的显示出来，就像是被画出来的感觉，简单的描述看下图，详细的请参照[zxx的文字](http://www.zhangxinxu.com/wordpress/2014/04/animateion-line-drawing-svg-path-%E5%8A%A8%E7%94%BB-%E8%B7%AF%E5%BE%84/)。

![线条动画]({{site.assets}}/article/201612/gift-1.jpg)

然后到了繁多的小元素以及图片动画的部分，之所以这些部分要合起来一起说，是因为他们的原理的其实都是类似的，都是从无到部分到全部这样的过程。线性出现的部分我就不多阐述了，其实就是利用到一个比较少用到的“老”属性—— **clip**，就是裁剪某些部分，动画就是把这个裁剪区域变化就可以啦。由于老式的clip是基于矩形的，所以很多不规则的方式就不能实现了。所以这个时候又到了我们亲爱的SVG出场了，但是感谢CSS 3的到来，吸取了SVG中的优势，CSS 3也有同样的实现方案，那就是[clip-path](http://www.w3cplus.com/css3/using-making-sense-of-clip-path.html)。clip-path是一个挺多内容的属性，详细的介绍我就不多说了，我们这里只是用了多边形裁剪**polygon**，如下图示意，只需要不断变化多边形的坐标就可以达到不规则裁剪的动画了。

*ps: 如果要用polygon做动画的话，一定要保证point的个数是不变的，不然动画可不生效哟*

![不规则裁剪]({{site.assets}}/article/201612/gift-2.jpg)

最后就是橡皮擦的部分，本来看到这个效果的时候，我脑海中浮现的是用mask可破，但是经过试验，虽然是可以解决，但是每一个擦开需要额外多套一层，这样就会导致多了5层嵌套，嵌套多的影响且不说，每一层的mask动画开销是我所接受不了的，所以最后是使用了canvas来解决，原理就是在前置动画都完成了以后隐藏掉其余dom，然后用一个一模一样的静态图来进行canvas绘制橡皮擦的效果，其中详细技术就不谈了，最主要是用到**globalCompositeOperation = destination-out**，其他就是普通料啦。

最后的最后就是奉上:

<img src="{{site.assets}}/article/201612/qrcode.png" width="50%" alt="">。